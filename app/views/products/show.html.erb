<p id="notice"><%= notice %></p>

<%= image_tag(@product.image) %>

<p>
   Posted By: <%= @product.user.email %>
</p>

<p>
  <strong>Title:</strong>
  <%= @product.title %>
</p>

<p>
  <strong>Description:</strong>
  <%= @product.description %>
</p>

<p>
  <strong>Category:</strong>
  <%= @product.category.name %>
</p>


<p>
  <strong>Individual Price:</strong>
  <%= hidden_field_tag(:price, (@product.price / 100.0)) %>
  <%=  number_to_currency(@product.price/100.0) %>
</p>
<p>
  <strong>Available Stock:</strong>
  <%= @product.stock %>
</p>

<strong>Quantity:</strong>
<%= number_field(:order, :quantity, in: 1..2000, step: 1, value: 1, id: 'qty') %>
<p>
  <strong>Total Price:</strong>
  
  <span id="total"><%=  number_to_currency(@product.price/100.0) %><span>
</p>

<%= form_tag charges_path do %>
  <article>
    <% if flash[:error].present? %>
      <div id="error_explanation">
        <p><%= flash[:error] %></p>
      </div>
    <% end %>

  </article>

  <%= hidden_field_tag(:product_id, @product.id) %>
 
  <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
          data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
         
          data-description="<%= @product.title %>"
          data-amount="<%= @product.price %>"
          data-currency="AUD"
          data-locale="auto"></script>
<% end %>

<br>

<%= link_to 'Edit', edit_product_path(@product) %> |
<%= link_to 'Back', products_path %>


<script>
  var total = 0
  var totalElement = document.getElementById('total')
  var price = document.getElementById('price')
  var qty = document.getElementById('qty')
  qty.addEventListener('change', updateTotal)

  function updateTotal(event) {
    var qtyVal = event.target.value
    total = qtyVal * price.value
    totalElement.innerText = '$' + total
  }
</script>